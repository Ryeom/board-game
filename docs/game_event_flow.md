# 게임 관련 이벤트 문서

이 문서는 현재 프로젝트에서 발생하는 게임과 관련된 WebSocket 이벤트의 흐름과 처리 원칙을 설명함.
## ✨ 이벤트 처리 원칙

- **단일 성공 응답 원칙:** 하나의 특정 사용자 액션 또는 서버 내부 이벤트 발생 시, 각 사용자에게는 **하나의 최종 성공 응답**(`success` 상태의 응답)이 전달되는 것을 기본 원칙으로 합니다. (중복 응답 배제)

    - **예외 (오류 처리):** 특정 액션 처리 중 오류가 발생할 경우, 해당 사용자에게 먼저 **오류 응답**(`error` 상태의 응답)이 전달될 수 있습니다. 하지만 최종적인 액션의 성공 여부에 따라 성공 응답 또는 추가 오류 응답이 발생할 수 있습니다. (향후 상세 로직 반영 예정)
  
- event type은 수신자에게는 현재진행형으로 전송, 이벤트를 발생시킨 주체에게 성공/실패 응답시에는 과거형으로 전송.

---

## ▶️ 게임 시작 흐름

| 단계  | 발신         | 수신         | 이벤트 타입 (in/out)        | 설명                                                                         |
| --- |------------|------------|------------------------| -------------------------------------------------------------------------- |
| 1.  | **HOST**   | **SERVER** | `in: game.start`       | 방장이 게임 시작을 요청합니다.                                                          |
| 2.  | **SERVER** |            |                        | 서버는 게임 시작 요청을 처리한 후, 방에 참여한 **모든 플레이어**에게 게임이 시작되었음을 알리고 초기 게임 상태를 동기화합니다. |
|     |            | **ALL**    | `out: game.start.init` | 게임 시작 알림 (방 ID, 방장 ID 등 기본 정보)     |
| 3.  |            | **HOST**   | `out: game.started`    | 방장에게 게임 시작 요청에 대한 최종 성공 응답이 전달됩니다. |

---

## 🔄 게임 진행 (턴 기반)

| 단계 | 발신         | 수신         | 이벤트 타입 (in/out)              | 설명                                                                  |
|----|------------|------------|------------------------------| ------------------------------------------------------------------- |
| 1. | **PLAYER** | **SERVER** | `in: game.action`            | 현재 턴 플레이어가 게임 액션(예: 힌트 주기, 카드 내려놓기, 카드 버리기, 턴 종료)을 요청합니다.           |
| 2. | **SERVER** |            | `out:`                       | 서버는 플레이어의 액션을 처리한 후, 게임 상태를 업데이트하고 **모든 플레이어**에게 변경된 게임 상태를 동기화합니다. |
| 3. |            | **ALL**    | `out: game.action.sync`      | 액션을 요청한 플레이어에게 해당 액션의 처리 결과(성공) 응답이 전달됩니다.                          |
| 4. |            | **PLAYER** | `out: game.action.succeeded` | 액션을 요청한 플레이어에게 해당 액션의 처리 결과(성공) 응답이 전달됩니다.                          |

---

## 🔚 게임 종료 흐름

|단계| 주체                       |이벤트 타입 (in/out)|설명|
|---|--------------------------|---|---|
|1.| **PLAYER** 또는 **SERVER** |`in: game.end` 또는 내부 트리거|플레이어가 명시적으로 게임 종료를 요청하거나, 게임 진행 중 자동으로 종료 조건이 충족됩니다.|
|2.| **SERVER**               |`out: ALL`|서버는 게임 종료 조건을 확인하고, 모든 플레이어에게 게임이 종료되었음을 알립니다.|
||                          |- `game.ended`|게임 종료 알림 (최종 승패 결과, 점수 등 포함)|
|3.| **PLAYER**               |`out: game.end`|게임 종료를 요청한 플레이어에게 최종 성공 응답이 전달됩니다.|

**게임 종료 조건:**

- **승리 또는 패배 조건 충족:** 게임의 규칙에 명시된 승리 또는 패배 조건(예: 하나비 불꽃놀이 5점 완성, 미스 토큰 3개 소진)이 달성된 경우.
- **최소 플레이어 수 미달:** 게임을 더 이상 진행할 수 있는 최소 인원(예: 2명) 미만이 된 경우.
    - 이는 플레이어의 연결 끊김, 방 퇴장 등의 이유로 발생할 수 있습니다.
- **명시적 게임 종료 요청:** 방장이 게임을 강제로 종료하는 경우.
